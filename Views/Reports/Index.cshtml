@model FridgeManagementSystem.Models.ReportDashboardViewModel

@{
    ViewData["Title"] = "Reports Dashboard";
    Layout = "_Layout";
}

<style>
    .container-fluid {
        padding: 8px 12px;
        background: #f8f9fa;
    }

    .header-section {
        margin-bottom: 12px;
    }

        .header-section h1 {
            font-size: 1.4rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }

    .btn-compact {
        padding: 5px 10px;
        font-size: 0.8rem;
        border-radius: 3px;
    }

    .card {
        margin-bottom: 12px;
        border: 1px solid #dee2e6;
        border-radius: 5px;
        box-shadow: 0 1px 2px rgba(0,0,0,0.08);
    }

    .card-header {
        padding: 8px 12px;
        font-size: 0.9rem;
        font-weight: 600;
    }

    .card-body {
        padding: 12px;
    }

    .summary-card {
        padding: 10px;
        margin-bottom: 8px;
        border-radius: 4px;
    }

        .summary-card .card-title {
            font-size: 0.75rem;
            margin-bottom: 4px;
            font-weight: 600;
        }

        .summary-card h2 {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 2px;
        }

        .summary-card small {
            font-size: 0.7rem;
            opacity: 0.8;
        }

    .chart-container {
        height: 180px;
        margin: 8px 0;
    }

    .table-sm {
        font-size: 0.8rem;
    }

        .table-sm th,
        .table-sm td {
            padding: 6px 8px;
        }

    .row {
        margin-bottom: 8px;
    }

    .mb-2 {
        margin-bottom: 6px !important;
    }

    .mb-3 {
        margin-bottom: 10px !important;
    }

    .mt-2 {
        margin-top: 6px !important;
    }

    section {
        margin-bottom: 16px;
    }

    .form-label {
        font-size: 0.85rem;
        margin-bottom: 4px;
        font-weight: 500;
    }

    .bg-primary {
        background: linear-gradient(135deg, #3498db, #2980b9) !important;
    }

    .bg-success {
        background: linear-gradient(135deg, #27ae60, #219653) !important;
    }

    .bg-warning {
        background: linear-gradient(135deg, #f39c12, #e67e22) !important;
    }

    .bg-info {
        background: linear-gradient(135deg, #17a2b8, #138496) !important;
    }

    .bg-danger {
        background: linear-gradient(135deg, #e74c3c, #c0392b) !important;
    }

    .fas, .fab {
        font-size: 0.85rem;
        margin-right: 4px;
    }

    .loading {
        opacity: 0.6;
        pointer-events: none;
        position: relative;
    }

        .loading::after {
            content: "Loading...";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255,255,255,0.8);
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 0.8rem;
            z-index: 1000;
        }

    .spinner-sm {
        width: 0.9rem;
        height: 0.9rem;
    }

    .date-range-selector {
        background: #f8f9fa;
        border-radius: 5px;
        padding: 10px;
        margin-bottom: 15px;
    }

    .refresh-btn {
        cursor: pointer;
        transition: transform 0.3s;
    }

        .refresh-btn:hover {
            transform: rotate(180deg);
        }

    .loading-spinner {
        display: none;
        text-align: center;
        padding: 10px;
    }

    @@media (max-width: 768px) {
        .container-fluid {
            padding: 6px 8px;
        }

        .summary-card {
            margin-bottom: 6px;
        }

        .chart-container {
            height: 140px;
        }

        .card-header {
            padding: 6px 10px;
            font-size: 0.85rem;
        }

        .card-body {
            padding: 10px;
        }
    }
</style>

<div class="container-fluid">
    <!-- Compact Header Section -->
    <div class="header-section">
        <div class="d-flex justify-content-between align-items-center">
            <a href="@Url.Action("Dashboard", "ManageEmployee", new { area = "Administrator" })" class="btn btn-secondary btn-compact">
                <i class="fas fa-arrow-left"></i>Back to Dashboard
            </a>
            <h1 class="mb-0">Reports Dashboard</h1>
            <div>
                <button class="btn btn-outline-primary btn-compact refresh-btn" onclick="refreshAllCharts()" title="Refresh Data">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
        </div>
    </div>

    <!-- Date Range Selector -->
    <div class="date-range-selector">
        <div class="row align-items-center">
            <div class="col-md-8">
                <div class="row">
                    <div class="col-md-3">
                        <label class="form-label">Start Date</label>
                        <input type="date" id="startDate" class="form-control form-control-sm" value="@DateTime.Today.AddDays(-30).ToString("yyyy-MM-dd")" />
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">End Date</label>
                        <input type="date" id="endDate" class="form-control form-control-sm" value="@DateTime.Today.ToString("yyyy-MM-dd")" />
                    </div>
                    <div class="col-md-3 d-flex align-items-end">
                        <button class="btn btn-primary btn-sm" onclick="applyDateRange()">
                            <i class="fas fa-filter"></i> Apply Filter
                        </button>
                    </div>
                </div>
            </div>
            <div class="col-md-4 text-end">
                <small class="text-muted" id="dateRangeDisplay">Last 30 days</small>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div class="loading-spinner" id="globalLoading">
        <div class="spinner-border spinner-border-sm text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <small class="ms-2">Loading report data...</small>
    </div>

    <!-- Maintenance Performance - Compact -->
    <div class="card mb-3">
        <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
            <span><i class="fas fa-chart-bar"></i> Maintenance Performance - This Month</span>
            <small>@DateTime.Now.ToString("MMMM yyyy")</small>
        </div>
        <div class="card-body">
            <canvas id="maintenanceChart" height="120"></canvas>
        </div>
    </div>

    <!-- Customer Management Reports - Compact -->
    <section class="mb-4">
        <div class="card">
            <div class="card-header bg-success text-white">
                <i class="fas fa-users"></i> Customer Management Report
            </div>
            <div class="card-body p-2">
                <!-- Fridges Overview Chart Only -->
                <div class="col-12 mb-3">
                    <div class="card">
                        <div class="card-header py-2 d-flex justify-content-between align-items-center">
                            <h6 class="card-title mb-0">Fridges Overview</h6>
                            <small class="text-muted">Real-time Status</small>
                        </div>
                        <div class="card-body p-2 d-flex justify-content-center">
                            <canvas id="fridgeChart" height="300" style="max-width:100%;"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Top 10 Customers Table in its own section -->
    <section class="mb-4">
        <div class="card">
            <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                <span><i class="fas fa-users"></i> Top 10 Customers</span>
                <small>By Total Spending</small>
            </div>
            <div class="card-body p-2 table-responsive">
                <table class="table table-sm table-striped table-bordered mb-0">
                    <thead class="table-dark">
                        <tr>
                            <th>#</th>
                            <th>Customer Name</th>
                            <th>Total Amount</th>
                            <th>Orders</th>
                        </tr>
                    </thead>
                    <tbody>
                        @for (int i = 0; i < Model.TopCustomers.Count; i++)
                        {
                            <tr>
                                <td>@(i + 1)</td>
                                <td>@Model.TopCustomers[i].Name</td>
                                <td>@Model.TopCustomers[i].TotalAmount.ToString("C")</td>
                                <td>
                                    <span class="badge bg-primary">@Model.TopCustomers[i].TotalAmount.ToString("N0")</span>
                                </td>
                            </tr>
                        }
                        @if (Model.TopCustomers.Count == 0)
                        {
                            <tr>
                                <td colspan="4" class="text-center text-muted">No customer data available</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Custom Reports Actions -->
        <div class="row mt-4">
            <div class="col-12 text-center">
                <div class="card bg-light">
                    <div class="card-body">
                        <h5 class="card-title">Custom Report Actions</h5>
                        <p class="card-text">Generate custom reports and export data for further analysis.</p>
                        <button class="btn btn-info me-2" onclick="exportReport('pdf')">
                            <i class="fas fa-download me-2"></i>Export PDF
                        </button>
                        <button class="btn btn-outline-info" onclick="exportReport('excel')">
                            <i class="fas fa-plus me-2"></i>Create Custom Report
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Customer Spending Report Button -->
        <div class="row mt-3">
            <div class="col-12 text-center">
                <a href="@Url.Action("AllCustomersSpendingReport", "Reports")" class="btn btn-primary btn-sm">
                    <i class="fas fa-users me-2"></i> View Customer Spending Report
                </a>
            </div>
        </div>
    </section>

    <!-- Fault Management Reports - Compact -->
    <section class="mb-4">
        <div class="card">
            <div class="card-header bg-danger text-white d-flex justify-content-between align-items-center">
                <span><i class="fas fa-exclamation-triangle"></i> Fault Management Report</span>
                <small id="faultDateRange">Last 30 days</small>
            </div>
            <div class="card-body p-2">
                <!-- Fault Summary Cards -->
                <div class="row mb-3">
                    <div class="col-md-3">
                        <div class="card text-white bg-danger summary-card">
                            <div class="card-body text-center p-2">
                                <h6 class="card-title">Total Faults</h6>
                                <h2 id="totalFaults" class="mb-1">@Model.TotalFaultsCount</h2>
                                <small>All Time</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-white bg-warning summary-card">
                            <div class="card-body text-center p-2">
                                <h6 class="card-title">Pending Faults</h6>
                                <h2 id="pendingFaults" class="mb-1">@Model.PendingFaultsCount</h2>
                                <small>Awaiting Action</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-white bg-primary summary-card">
                            <div class="card-body text-center p-2">
                                <h6 class="card-title">High Priority</h6>
                                <h2 id="highPriorityFaults" class="mb-1">@Model.HighPriorityFaultsCount</h2>
                                <small>Urgent Cases</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-white bg-success summary-card">
                            <div class="card-body text-center p-2">
                                <h6 class="card-title">Resolved</h6>
                                <h2 id="resolvedFaults" class="mb-1">@Model.ResolvedFaultsCount</h2>
                                <small>Completed</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Fault Charts -->
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header py-2 d-flex justify-content-between align-items-center">
                                <h6 class="card-title mb-0">Fault Type Distribution</h6>
                                <button class="btn btn-sm btn-outline-secondary" onclick="loadFaultTypeDistribution()" title="Refresh">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                            <div class="card-body p-2">
                                <canvas id="faultTypeChart" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header py-2 d-flex justify-content-between align-items-center">
                                <h6 class="card-title mb-0">Urgency Level Distribution</h6>
                                <button class="btn btn-sm btn-outline-secondary" onclick="loadUrgencyDistribution()" title="Refresh">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                            <div class="card-body p-2">
                                <canvas id="faultUrgencyChart" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Faults Table -->
                <div class="row mt-3">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header py-2">
                                <h6 class="card-title mb-0">Recent Fault Reports</h6>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-sm table-hover mb-0">
                                        <thead class="table-light">
                                            <tr>
                                                <th>Date</th>
                                                <th>Fridge</th>
                                                <th>Customer</th>
                                                <th>Fault Type</th>
                                                <th>Urgency</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var fault in Model.RecentFaults)
                                            {
                                                <tr>
                                                    <td>@fault.ReportDate.ToString("MMM dd, yyyy")</td>
                                                    <td>@fault.Fridge?.Brand @fault.Fridge?.Model</td>
                                                    <td>@fault.Fridge?.Customer?.FullName</td>
                                                    <td><span class="badge bg-secondary">@fault.FaultType</span></td>
                                                    <td>
                                                        <span class="badge @GetUrgencyBadgeClass(fault.UrgencyLevel)">
                                                            @fault.UrgencyLevel
                                                        </span>
                                                    </td>
                                                    <td>
                                                        <span class="badge @GetStatusBadgeClass(fault.Status)">
                                                            @fault.Status
                                                        </span>
                                                    </td>
                                                </tr>
                                            }
                                            @if (Model.RecentFaults.Count == 0)
                                            {
                                                <tr>
                                                    <td colspan="6" class="text-center text-muted">No recent faults</td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Card -->
                <div class="row mt-3">
                    <div class="col-12">
                        <div class="card bg-light">
                            <div class="card-body text-center py-3">
                                <h6 class="card-title mb-2">Need Detailed Fault Analysis?</h6>
                                <p class="card-text mb-2 small">Access comprehensive fault analytics with detailed breakdowns.</p>
                                <a href="@Url.Action("FaultReports", "Reports")" class="btn btn-danger btn-sm">
                                    <i class="fas fa-chart-bar"></i> View Detailed Reports
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

@functions {
    public string GetUrgencyBadgeClass(UrgencyLevel urgency)
    {
        return urgency switch
        {
            UrgencyLevel.Emergency => "bg-danger",
            UrgencyLevel.Critical => "bg-danger",
            UrgencyLevel.High => "bg-warning",
            UrgencyLevel.Medium => "bg-info",
            UrgencyLevel.Low => "bg-success",
            _ => "bg-secondary"
        };
    }

    public string GetStatusBadgeClass(FridgeManagementSystem.Models.TaskStatus status)
    {
        return status switch
        {
            FridgeManagementSystem.Models.TaskStatus.Pending => "bg-warning",
            FridgeManagementSystem.Models.TaskStatus.InProgress => "bg-info",
            FridgeManagementSystem.Models.TaskStatus.Complete => "bg-success",
            FridgeManagementSystem.Models.TaskStatus.Cancelled => "bg-secondary",
            _ => "bg-secondary"
        };
    }
}

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Global variables
        let currentStartDate = '@DateTime.Today.AddDays(-30).ToString("yyyy-MM-dd")';
        let currentEndDate = '@DateTime.Today.ToString("yyyy-MM-dd")';

        // Initialize charts when page loads
        $(document).ready(function () {
            initializeDatePickers();
            createFridgeStatusChart();
            loadFaultSummaryData();
            loadFaultTypeDistribution();
            loadUrgencyDistribution();
        });

        // Date range functionality
        function initializeDatePickers() {
            const today = new Date().toISOString().split('T')[0];
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
            const thirtyDaysAgoStr = thirtyDaysAgo.toISOString().split('T')[0];

            $('#startDate').val(thirtyDaysAgoStr);
            $('#endDate').val(today);

            currentStartDate = thirtyDaysAgoStr;
            currentEndDate = today;
        }

        function applyDateRange() {
            const startDate = $('#startDate').val();
            const endDate = $('#endDate').val();

            if (!startDate || !endDate) {
                alert('Please select both start and end dates');
                return;
            }

            if (new Date(startDate) > new Date(endDate)) {
                alert('Start date cannot be after end date');
                return;
            }

            currentStartDate = startDate;
            currentEndDate = endDate;

            // Update display
            const start = new Date(startDate).toLocaleDateString();
            const end = new Date(endDate).toLocaleDateString();
            $('#dateRangeDisplay').text(`${start} - ${end}`);
            $('#faultDateRange').text(`${start} - ${end}`);

            // Reload fault data with new date range
            showLoading();
            loadFaultSummaryData();
            loadFaultTypeDistribution();
            loadUrgencyDistribution();
        }

        function refreshAllCharts() {
            showLoading();
            loadFaultSummaryData();
            loadFaultTypeDistribution();
            loadUrgencyDistribution();
        }

        function showLoading() {
            $('#globalLoading').show();
            setTimeout(() => {
                $('#globalLoading').hide();
            }, 1000);
        }

        // ===== FAULT REPORTS DATA FETCHING =====

        async function loadFaultSummaryData() {
            try {
                const url = `@Url.Action("GetFaultSummaryData", "Reports")?startDate=${currentStartDate}&endDate=${currentEndDate}`;
                const response = await fetch(url);

                if (!response.ok) throw new Error('Network response was not ok');

                const data = await response.json();

                if (data.success === false) {
                    throw new Error(data.error || 'Unknown error occurred');
                }

                // Update summary cards
                document.getElementById('totalFaults').textContent = data.totalFaults?.toLocaleString() || '0';
                document.getElementById('pendingFaults').textContent = data.pendingFaults?.toLocaleString() || '0';
                document.getElementById('highPriorityFaults').textContent = data.highPriorityFaults?.toLocaleString() || '0';
                document.getElementById('avgResolutionDays').textContent = data.averageResolutionDays?.toFixed(1) || '0';

            } catch (error) {
                console.error('Error loading fault summary data:', error);
                showError('Failed to load fault summary data');
            }
        }

        async function loadFaultTypeDistribution() {
            try {
                const url = `@Url.Action("GetFaultTypeDistribution", "Reports")?startDate=${currentStartDate}&endDate=${currentEndDate}`;
                const response = await fetch(url);

                if (!response.ok) throw new Error('Network response was not ok');

                const result = await response.json();
                const data = result.data || result;

                if (data.success === false) {
                    throw new Error(data.error || 'Unknown error occurred');
                }

                renderFaultTypeChart(data);

            } catch (error) {
                console.error('Error loading fault type distribution:', error);
                renderFaultTypeChart([]);
                showError('Failed to load fault type distribution');
            }
        }

        async function loadUrgencyDistribution() {
            try {
                const url = `@Url.Action("GetUrgencyDistribution", "Reports")?startDate=${currentStartDate}&endDate=${currentEndDate}`;
                const response = await fetch(url);

                if (!response.ok) throw new Error('Network response was not ok');

                const result = await response.json();
                const data = result.data || result;

                if (data.success === false) {
                    throw new Error(data.error || 'Unknown error occurred');
                }

                renderUrgencyChart(data);

            } catch (error) {
                console.error('Error loading urgency distribution:', error);
                renderUrgencyChart([]);
                showError('Failed to load urgency distribution');
            }
        }

        // ===== CHART RENDERING FUNCTIONS =====

        function renderFaultTypeChart(data) {
            const ctx = document.getElementById('faultTypeChart');
            if (!ctx) return;

            // Destroy existing chart if it exists
            if (ctx.chart) {
                ctx.chart.destroy();
            }

            // If no data, show empty state
            if (!data || data.length === 0) {
                const context = ctx.getContext('2d');
                context.fillStyle = '#6c757d';
                context.font = '12px Arial';
                context.textAlign = 'center';
                context.fillText('No data available for selected date range', ctx.width / 2, ctx.height / 2);
                return;
            }

            ctx.chart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: data.map(item => item.faultType),
                    datasets: [{
                        data: data.map(item => item.count),
                        backgroundColor: [
                            '#e74c3c', '#3498db', '#f39c12', '#2ecc71',
                            '#9b59b6', '#1abc9c', '#34495e', '#f1c40f',
                            '#e67e22', '#16a085', '#8e44ad', '#2c3e50'
                        ],
                        borderWidth: 1,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                boxWidth: 12,
                                font: {
                                    size: 9
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    },
                    cutout: '60%'
                }
            });
        }

        function renderUrgencyChart(data) {
            const ctx = document.getElementById('faultUrgencyChart');
            if (!ctx) return;

            // Destroy existing chart if it exists
            if (ctx.chart) {
                ctx.chart.destroy();
            }

            // If no data, show empty state
            if (!data || data.length === 0) {
                const context = ctx.getContext('2d');
                context.fillStyle = '#6c757d';
                context.font = '12px Arial';
                context.textAlign = 'center';
                context.fillText('No data available for selected date range', ctx.width / 2, ctx.height / 2);
                return;
            }

            // Define urgency level colors
            const urgencyColors = {
                'Emergency': '#c0392b',
                'Critical': '#e74c3c',
                'High': '#e67e22',
                'Medium': '#f39c12',
                'Low': '#27ae60'
            };

            ctx.chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(item => item.urgencyLevel),
                    datasets: [{
                        label: 'Number of Faults',
                        data: data.map(item => item.count),
                        backgroundColor: data.map(item => urgencyColors[item.urgencyLevel] || '#95a5a6'),
                        borderWidth: 0,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                font: {
                                    size: 9
                                },
                                precision: 0
                            },
                            title: {
                                display: true,
                                text: 'Number of Faults'
                            }
                        },
                        x: {
                            ticks: {
                                font: {
                                    size: 9
                                }
                            },
                            title: {
                                display: true,
                                text: 'Urgency Level'
                            }
                        }
                    }
                }
            });
        }

        // ===== EXISTING CHARTS =====

        var ctx = document.getElementById('maintenanceChart').getContext('2d');
        var chart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Completed Tasks', 'Avg Days to Complete', 'Success Rate %', 'Repeat Visits'],
                datasets: [{
                    label: 'Maintenance KPI',
                    data: [
        @Model.MaintenanceKpi.CompletedThisMonth,
        @Model.MaintenanceKpi.AvgCompletionDays.ToString("0.0"),
        @Model.MaintenanceKpi.SuccessRate.ToString("0.0"),
        @Model.MaintenanceKpi.MonthlyRepeatVisits
                    ],
                    backgroundColor: ['#3498db', '#2ecc71', '#f1c40f', '#e74c3c']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'KPI Values'
                        }
                    }
                },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed.y !== null) {
                                    if (context.dataIndex === 2) { // Success Rate
                                        label += context.parsed.y.toFixed(1) + '%';
                                    } else if (context.dataIndex === 1) { // Avg Days
                                        label += context.parsed.y.toFixed(1) + ' days';
                                    } else {
                                        label += context.parsed.y;
                                    }
                                }
                                return label;
                            }
                        }
                    }
                }
            }
        });

        function createFridgeStatusChart() {
            var ctx = document.getElementById('fridgeChart').getContext('2d');
            var fridgeChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Received', 'Purchased', 'Scrapped', 'Low Stock', 'Returned'],
                    datasets: [{
                        label: 'Fridges Overview',
                        data: [
        @Model.Received,
        @Model.Purchased,
        @Model.Scrapped,
        @Model.LowStock,
        @Model.Returned
                        ],
                        backgroundColor: 'rgba(46, 204, 113, 0.2)',
                        borderColor: 'rgba(46, 204, 113, 1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        pointRadius: 6,
                        pointBackgroundColor: 'rgba(39, 174, 96, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: true },
                        title: {
                            display: true,
                            text: 'Fridges Overview - Current Status'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Count'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Status Categories'
                            }
                        }
                    }
                }
            });
        }

        // Utility functions
        function exportReport(format) {
            alert(`Export functionality for ${format.toUpperCase()} would be implemented here`);
            // Implementation for export would go here
        }

        function showError(message) {
            // You could implement a toast notification here
            console.error('Error:', message);
        }
    </script>
}