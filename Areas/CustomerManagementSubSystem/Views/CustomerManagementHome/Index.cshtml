@model FridgeManagementSystem.ViewModels.DashboardViewModel

@{
    ViewData["Title"] = "Customer Management Dashboard";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />

<div class="container-fluid mt-4">

    <h2 class="mb-4 fw-bold text-center text-secondary">Customer Management Dashboard</h2>

    <!-- ================== Alerts Row ================== -->
    <div class="row g-3 mb-4">

        <!-- Low Stock -->
        <div class="col-md-2">
            <div class="card text-white bg-danger h-100 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">Low Stock Fridges</h5>
                    <p class="card-text fs-4">@Model.LowStockFridges?.Count() ?? 0</p>
                    <a class="btn btn-light btn-sm" data-bs-toggle="collapse" href="#lowStockTable" role="button">View</a>
                </div>
            </div>
        </div>

        <!-- New Customers -->
        <div class="col-md-2">
            <div class="card text-white bg-success h-100 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">New Customers (30 Days)</h5>
                    <p class="card-text fs-4">@Model.NewCustomers?.Count() ?? 0</p>
                    <a class="btn btn-light btn-sm" data-bs-toggle="collapse" href="#newCustomersTable" role="button">View</a>
                </div>
            </div>
        </div>

        <!-- Pending Allocations -->
        <div class="col-md-2">
            <div class="card text-white bg-warning h-100 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">Pending Allocations</h5>
                    <p class="card-text fs-4">@Model.PendingAllocations?.Count() ?? 0</p>
                    <a class="btn btn-light btn-sm" data-bs-toggle="collapse" href="#pendingAllocationsTable" role="button">View</a>
                </div>
            </div>
        </div>

        <!-- Pending Purchase Requests -->
        <div class="col-md-2">
            <div class="card text-white bg-primary h-100 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">Pending Purchase Requests</h5>
                    <p class="card-text fs-4">@Model.PendingPurchaseRequests?.Count() ?? 0</p>
                    <a class="btn btn-light btn-sm" data-bs-toggle="collapse" href="#pendingPRTable" role="button">View</a>
                </div>
            </div>
        </div>

        <!-- Fridge Summary -->
        <div class="col-md-4">
            <div class="card text-white bg-info h-100 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">Fridge Summary</h5>
                    <p class="card-text fs-6">
                        Total: @Model.FridgeSummary?.Count() ?? 0<br />
                        Available: @Model.FridgeSummary?.Count(f => f.Status == "Available") ?? 0<br />
                        Allocated: @Model.FridgeSummary?.Count(f => f.Status == "Allocated") ?? 0<br />
                        Damaged: @Model.FridgeSummary?.Count(f => f.Status == "Damaged") ?? 0<br />
                        Scrapped: @Model.FridgeSummary?.Count(f => f.Status == "Scrapped") ?? 0
                    </p>
                </div>
            </div>
        </div>

    </div>

    <!-- ================== Tables Row ================== -->
    <div class="row g-4">

        <!-- Low Stock Table -->
        <div class="col-12 collapse" id="lowStockTable">
            <div class="card shadow-sm">
                <div class="card-header bg-danger text-white fw-bold">Low Stock Fridges</div>
                <div class="card-body p-2">
                    <table class="table table-striped table-hover table-sm">
                        <thead>
                            <tr>
                                <th>Brand</th>
                                <th>Model</th>
                                <th>Status</th>
                                <th>Quantity</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var f in Model.LowStockFridges ?? Enumerable.Empty<Fridge>())
                            {
                                <tr>
                                    <td>@f.Brand</td>
                                    <td>@f.Model</td>
                                    <td>@f.Status</td>
                                    <td>@f.Quantity</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- New Customers Table -->
        <div class="col-12 collapse" id="newCustomersTable">
            <div class="card shadow-sm">
                <div class="card-header bg-success text-white fw-bold">New Customers</div>
                <div class="card-body p-2">
                    <table class="table table-striped table-hover table-sm">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Location</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var c in Model.NewCustomers ?? Enumerable.Empty<Customer>())
                            {
                                <tr>
                                    <td>@c.FullName</td>
                                    <td>@c.Email</td>
                                    <td>@c.PhoneNumber</td>
                                    <td>@c.Location?.City ?? "N/A"</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Pending Allocations Table -->
        <div class="col-12 collapse" id="pendingAllocationsTable">
            <div class="card shadow-sm">
                <div class="card-header bg-warning text-dark fw-bold">Pending Allocations</div>
                <div class="card-body p-2">
                    <table class="table table-striped table-hover table-sm">
                        <thead>
                            <tr>
                                <th>Customer</th>
                                <th>Fridge</th>
                                <th>Ordered</th>
                                <th>Allocated</th>
                                <th>Pending</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var p in Model.PendingAllocations ?? Enumerable.Empty<FridgeAllocation>())
                            {
                                <tr>
                                    <td>@p.Customer?.FullName ?? "N/A"</td>
                                    <td>@p.Fridge?.Brand @p.Fridge?.Model</td>
                                    <td>@p.QuantityOrdered</td>
                                    <td>@p.QuantityAllocated</td>
                                    <td>@(p.QuantityOrdered - p.QuantityAllocated)</td>
                                    <td>@(p.QuantityAllocated < p.QuantityOrdered ? "Pending" : "Allocated")</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Pending Purchase Requests Table -->
        <div class="col-12 collapse" id="pendingPRTable">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white fw-bold">Pending Purchase Requests</div>
                <div class="card-body p-2">
                    <table class="table table-striped table-hover table-sm">
                        <thead>
                            <tr>
                                <th>Request #</th>
                                <th>Item</th>
                                <th>Quantity</th>
                                <th>Date</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var pr in Model.PendingPurchaseRequests ?? Enumerable.Empty<PurchaseRequest>())
                            {
                                <tr>
                                    <td>@pr.RequestNumber</td>
                                    <td>@pr.ItemFullNames</td>
                                    <td>@pr.Quantity</td>
                                    <td>@pr.RequestDate?.ToDateTime(TimeOnly.MinValue).ToShortDateString()</td>
                                    <td>@pr.Status</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
